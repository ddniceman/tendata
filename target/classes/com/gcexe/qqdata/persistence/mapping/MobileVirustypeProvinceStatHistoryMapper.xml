<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.gcexe.qqdata.persistence.dao.MobileVirustypeProvinceStatHistoryMapper">
	<resultMap id="BaseResultMap"
		type="com.gcexe.qqdata.persistence.entity.MobileVirustypeProvinceStatHistoryKey">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Apr 20 
			15:12:34 CST 2018. -->
		<id column="cnt" property="cnt" jdbcType="INTEGER" />
		<id column="province" property="province" jdbcType="VARCHAR" />
		<id column="ts" property="ts" jdbcType="TIMESTAMP" />
		<id column="virus_type" property="virusType" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="virusTypeStatisticsMap"
		type="com.gcexe.qqdata.persistence.statistics.VirusTypeStatistics">
		<id column="cnt" property="cnt" jdbcType="INTEGER" />
		<id column="mcnt" property="mcnt" jdbcType="INTEGER" />
		<id column="virus_type" property="virusType" jdbcType="VARCHAR" />
	</resultMap>

	<select id="getMobileVirusTypeStatistics"
		resultMap="virusTypeStatisticsMap">
		SELECT SUM(cnt) as cnt,SUM(cnt*0.8) as mcnt,
		CASE virus_type
		WHEN 'consumption' THEN '资费消耗'
		WHEN 'fraudm' THEN '诱骗欺诈'
		WHEN 'payment'
		THEN '恶意扣费'
		WHEN 'privacy' THEN '隐私获取'
		WHEN 'propagation' THEN '恶意传播'
		WHEN 'remote' THEN '远程控制'
		WHEN 'rogue' THEN '流氓行为'
		WHEN 'system' THEN
		'系统破坏'
		END as virus_type
		from mobile_virustype_province_stat_history
		WHERE virus_type ='rogue' or virus_type = 'consumption' or virus_type
		='privacy' or virus_type = 'payment'
		GROUP BY virus_type
	</select>

	<select id="getDayNum" resultType="java.lang.Integer">
		SELECT  COALESCE(SUM(cnt),0) as cnt
		from mobile_virustype_province_stat_history
		where DAYOFYEAR(ts) = DAYOFYEAR(NOW())
	</select>
	<select id="getDayMobileVirusStatistics"
		resultType="java.lang.Integer">
		select  COALESCE(SUM(cnt),0) as cnt
		from mobile_virustype_province_stat_history
		where hour(ts) = hour(NOW()) and DAYOFYEAR(ts) = DAYOFYEAR(NOW());
	</select>
	<select id="getYestodayMobileVirusStatistics"
		resultType="java.lang.Integer">
		SELECT  COALESCE(SUM(cnt),0) as cnt
		from mobile_virustype_province_stat_history
		where DATEDIFF(NOW(),ts) = 1 and hour(ts) = hour(NOW())
	</select>
	<select id="getWeekMobileVirusStatistics"
		resultType="java.lang.Integer">
		select  COALESCE(SUM(cnt),0) as cnt
		from mobile_virustype_province_stat_history
		where week(ts) = week(NOW()) and hour(ts) = hour(NOW())
	</select>
	<select id="getUpWeekMobileVirusStatistics"
		resultType="java.lang.Integer">
		select  COALESCE(SUM(cnt),0) as cnt
		from mobile_virustype_province_stat_history
		where week(ts) = (week(NOW())-1) and hour(ts) = hour(NOW())
	</select>



	<delete id="deleteByPrimaryKey"
		parameterType="com.gcexe.qqdata.persistence.entity.MobileVirustypeProvinceStatHistoryKey">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Apr 20 
			15:12:34 CST 2018. -->
		delete from mobile_virustype_province_stat_history
		where cnt =
		#{cnt,jdbcType=INTEGER}
		and province = #{province,jdbcType=VARCHAR}
		and
		ts = #{ts,jdbcType=TIMESTAMP}
		and virus_type =
		#{virusType,jdbcType=VARCHAR}
	</delete>
	<insert id="insert"
		parameterType="com.gcexe.qqdata.persistence.entity.MobileVirustypeProvinceStatHistoryKey">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Apr 20 
			15:12:34 CST 2018. -->
		insert into mobile_virustype_province_stat_history (cnt, province, ts,
		virus_type)
		values (#{cnt,jdbcType=INTEGER},
		#{province,jdbcType=VARCHAR},
		#{ts,jdbcType=TIMESTAMP},
		#{virusType,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective"
		parameterType="com.gcexe.qqdata.persistence.entity.MobileVirustypeProvinceStatHistoryKey">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Apr 20 
			15:12:34 CST 2018. -->
		insert into mobile_virustype_province_stat_history
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="cnt != null">
				cnt,
			</if>
			<if test="province != null">
				province,
			</if>
			<if test="ts != null">
				ts,
			</if>
			<if test="virusType != null">
				virus_type,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="cnt != null">
				#{cnt,jdbcType=INTEGER},
			</if>
			<if test="province != null">
				#{province,jdbcType=VARCHAR},
			</if>
			<if test="ts != null">
				#{ts,jdbcType=TIMESTAMP},
			</if>
			<if test="virusType != null">
				#{virusType,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
</mapper>